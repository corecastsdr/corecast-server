# docker-compose.yml

services:
  sdr-control:
    build:
      context: .
      dockerfile: Dockerfile
    image: evanparden/corecast:corecast-server
    container_name: corecast-server
    # network_mode: "host"

    restart: unless-stopped

    env_file: ./.env

    networks:
      corecast_net: {}


    ports:
      - "2222:2222"
      # waterfall
      - "50351:50351"
      # audio
      - "50350:50350"
      - "8002:8002"

    # This is the change. We are now using a "bind mount".
    # This links the ./ssh_keys folder from your computer into the container.

    security_opt:
      - "apparmor:unconfined"

    extra_hosts:
      - "host.docker.internal:host-gateway"


    volumes:
      # - ./ssh_keys:/app/host_keys
      # - ./proxychains.conf:/app/proxychains.conf:ro
      - ./sshd_config:/app/sshd_config:ro

    environment:

      ROLE: "all"

      SDR_REMOTE: "127.0.0.1:55132"
      # REMOTE_PROT: "tcp"
      REMOTE_TIMEOUT_MS: "100000"
      CENTER: "104100000"
      SPAN_RATE: "2048000"
      FFT_SIZE: "2048"
      AUD_RATE: "48000"
      GAIN_DB: "20"
      CHUNK_MS: "20"
      SOAPY_SDR_LOG_LEVEL: "INFO"
      PYTHONPATH: /usr/lib/python3/dist-packages
      LD_LIBRARY_PATH: /usr/lib

      REMOTE_MTU: "1280"

      MAX_CLIENTS: "10"

      INTERNAL_API_KEY: "change-me-to-a-very-long-secret-key"

      # This is the internal Docker DNS name for your API container
      METRICS_API_URL: "http://192.168.1.213:7000/api/metrics"

      ZMQ_PORT: "5678"





networks:
  corecast_net:
    external: true
